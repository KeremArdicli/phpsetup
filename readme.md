# Apache + MySQL + PHP Version Switcher for Windows

Starting web development may not be as easy for a newcomer. There are so many concepts you need to comprehend and put into practice.
As PHP is one of the most beloved web dev starting point (was the case for me!), XAMPP or WAMP would be the first softwares you will see that needed to be installed on your PC. It is indeed very easy to start with and rather beginner friendly. 

On th other hand, XAMPP and WAMP are restrincting using any PHP version you want or need. Besides, updating the software requires manual backing up. If you forget to back up your htdocs, or mysal data you are mostly in a black hole to revert back the state you were.

I have been there and it was a real disaster. Then I asked myself, "why do I not use my own set up?".
I have spent a good full day on bringing the pieces together and running things up as expected.

This setup will allow you running multiple PHP versions with Apache and MySQL without relying on XAMPP/WAMP.

While I use C:/ as main directory for softwares, and D:/ for data files, you can change the directories as per your desire. But keeping the data somewhere else make it flexible to update a sofware and keeping data intact. Even if a windows format will not effect you. I find this very valuable. 

## Prerequisites

- Windows 10 (Windows 11 is not tested but there is nothing restricting for things to work)
- Administrator privileges
- Downloaded software:
  - Apache 2.4 (from [Apache Lounge](https://www.apachelounge.com/download/))
  - Multiple PHP versions (from [windows.php.net](https://windows.php.net/download/))
  - MySQL (optional, from [mysql.com](https://dev.mysql.com/downloads/mysql/))

## Directory Structure
```md
C:/
├── Apache24/ # Apache installation
│ ├── conf/
│ │ ├── httpd.conf
│ │ └── httpd_phpXX.conf # Hand or Auto generated per PHP version
│ └── logs/
│
├── PHP/ # All PHP versions
│ ├── php81/
│ ├── php82/
│ └── php83/
│ └── php84/
│
└── mysql/ # MySQL installation
```


## Installation Steps

### 1. Install Apache
1. Extract Apache to `C:\Apache24`
2. Configure `C:\Apache24\conf\httpd.conf`:
   ```apache
   Define SRVROOT "C:/Apache24"
   ServerRoot "${SRVROOT}"
   Listen 8080  # Change if 80 is occupied

### 2. Install PHP Versions
1. For each PHP version (8.1, 8.2, 8.3):

Extract to C:\PHP\phpXX (e.g., C:\PHP\php82)

2. Rename php.ini-development to php.ini

3. Enable extensions in php.ini:
```ini
extension_dir = "C:\PHP\php8*\ext" ;exact directory for ext folder
extension=mysqli
extension=pdo_mysql
...
extension=intl ;intl extension is a bit problemmatic as it relies on external libararies. We will LoadFiles in Apache
```
### 3. Configure Version Switching
The batch script (apache_start.bat) handles:

- Creating version-specific configs (httpd_phpXX.conf)

- Loading correct PHP modules

- Managing dependencies (ICU, OpenSSL)

```sh
apache_start.bat [php_version]
Examples:
  apache_start.bat       # Uses php82 (default)
  apache_start.bat php83 # Uses php83
```
### 4. MySQL Setup (Optional)
1. Extract MySQL to C:\mysql

2. Initialize data directory (using cmd or powershell):

```sh
C:\mysql\bin\mysqld --initialize-insecure --datadir=D:\mysql_data # this can take some time be patient. This will generate files in D:\mysql_data folder.
```
## How it works?

### Configuration Files
- Main config `C:\Apache24\conf\httpd.conf` (In this setup, we won't be using it.)
- PHP version config files: Either Autogenerated or hand written: `httpd_php8*.conf` containing:
```apache
# these are required for ldap, curl, sqlite
LoadFile "C:\PHP\php8*\php8ts.dll"
LoadFile "C:\PHP\php8*\libpq.dll"
LoadFile "C:\PHP\php8*\libsqlite3.dll"

LoadModule php_module "C:/PHP/php8X/php8apache2_4.dll"
PHPIniDir "C:/PHP/php8X"
AddHandler application/x-httpd-php .php

# These are required for intl extension to run. You may need to Load other dll files for the extensions you are using.
LoadFile "C:\PHP\php8*\icudt**.dll"
LoadFile "C:\PHP\php8*\icuin**.dll" 
LoadFile "C:\PHP\php8*\icuio**.dll" 
LoadFile "C:\PHP\php8*\icuuc**.dll" 
```
### Starting Apache Server
- You can start Apache Server by running cmd `C:\Apache24\bin\httpd.exe" -X -f "C:\Apache24\conf\httpd_php82.conf""`
- Once you are done, do not forget to kill the task via cmd: `taskkill /f /im httpd.exe >nul 2>&1`
- Based the config file you feed, it will use different php version but the same www folder for your projects.
- Instead of running the command each time, you can use the `.bat` files and python script.
  Place bat files in C:/Apache24 folder. Run them either with double click or run python script to get a basic Xampp like UI.
  You can select PHP version and restart Apache for a quick version change.
- Python script would require Admin priviliges to run Apache as a Service.
- You can use pyinstaller with --uac-admin flag to make the compiled exe run with admin priviliges.

### Starting MySQL Server
- You can start MySQL server by running the cmd `"C:\mysql\bin\mysqld.exe" --datadir="D:\mysql_data" --console`
- Once you are done, do not forget to kill the task via cmd: `taskkill /f /im mysqld.exe >nul 2>&1`
- You can use `.bat` files in the repo to run the server. Or like Apache start, you can use python script in order to control status in a UI.
- Python script would require Admin priviliges to run Apache as a Service.
- You can use pyinstaller with --uac-admin flag to make the compiled exe run with admin priviliges.
